{{ define "main" }}
<div class="container">
    {{ $pages := where .Site.RegularPages "Type" "in" .Site.Params.mainSections | default .Pages }}
    {{ $pages = $pages.ByDate.Reverse }}
    {{ with first 1 $pages }}
        {{ range . }}
            <a href="{{ .Permalink }}" class="card-link" data-title="{{ .Title }}" aria-label="Read: {{ .Title }}">
                <div class="featured-post">
                    {{ $image := .Resources.GetMatch "cover.*" }}
                    {{ if $image }}
                    <div class="featured-image-container">
                        <img src="{{ $image.Permalink }}" alt="Cover image for {{ .Title }}" loading="lazy" decoding="async">
                    </div>
                    {{ end }}
                    <div class="featured-content">
                        {{ with .Params.tags }}<span class="post-meta">{{ index . 0 | upper }} / {{ $.Date.Format "Jan 2, 2006" }}</span>{{ end }}
                        <h2>{{ .Title }}</h2>
                        <p>{{ .Summary | plainify | truncate 180 }}</p>
                    </div>
                </div>
            </a>
        {{ end }}
    {{ end }}

    <nav class="category-nav">
        <a href="/tags/notes/">Notes</a>
        {{ $featuredTags := 5 }}
        {{ range first $featuredTags (where .Site.Taxonomies.tags.ByCount "Term" "ne" "notes") }}
            <a href="{{ .Page.Permalink }}">{{ .Page.Title | upper }}</a>
        {{ end }}
        <a href="/tags/" class="all-tags-link">ALL TAGS &rarr;</a>
    </nav>

    <div class="post-list">
        {{ range after 1 $pages }}
            {{ partial "post-card.html" . }}
        {{ end }}
    </div>
</div>
{{ end }}